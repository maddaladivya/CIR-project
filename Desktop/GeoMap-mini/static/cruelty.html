<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>flask_test</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<style type='text/css'>
    #info {
        display: block;
        position: relative;
        margin: 0px auto;
        width: 50%;
        padding: 10px;
        border: none;
        border-radius: 3px;
        font-size: 12px;
        text-align: center;
        color: #222;
        background: #fff;
    }
    .legend {
        background-color: #fff;
        border-radius: 3px;
        bottom: 30px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.10);
        font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        padding: 10px;
        position: absolute;
        right: 10px;
        z-index: 1;
    }
    .legend h4 {
        margin: 0 0 10px;
    }
    .legend div span {
        border-radius: 50%;
        display: inline-block;
        height: 10px;
        margin-right: 5px;
        width: 10px;
    }
    .mapboxgl-popup {
        max-width: 400px;
        font: 18px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    }
</style>

<div id='state-legend' class='legend'>
<h2>State Cruelty By Husband and Male Relatives Count Index</h2>
<div style="font-size:20px"><span style='background-color: #951e8b'></span>10000+</div>
<div style="font-size:20px"><span style='background-color: #a02e90'></span>8000-10000</div>
<div style="font-size:20px"><span style='background-color: #aa3d96'></span>7000-8000</div>
<div style="font-size:20px"><span style='background-color: #b54c9b'></span>6000-7000</div>
<div style="font-size:20px"><span style='background-color: #c05ba1'></span>5000-6000</div>
<div style="font-size:20px"><span style='background-color: #ca6aa6'></span>4000-5000</div>
<div style="font-size:20px"><span style='background-color: #df88b1'></span>3000-4000</div>
<div style="font-size:20px"><span style='background-color: #ea98b6'></span>2000-3000</div>
<div style="font-size:20px"><span style='background-color: #f4a7bc'></span>1000-2000</div>
<div style="font-size:20px"><span style='background-color: #ffb6c1'></span>0-1000</div>
</div>
    â€‹
<div id='district-legend' class='legend'>
<h2>District Cruelty By Husband and Male Relatives Count Index</h2>
<div style="font-size:20px"><span style='background-color: #750075'></span>600+</div>
<div style="font-size:20px"><span style='background-color: #800080'></span>550-600</div>
<div style="font-size:20px"><span style='background-color: #8b0f85'></span>500-550</div>
<div style="font-size:20px"><span style='background-color: #951e8b'></span>450-500</div>
<div style="font-size:20px"><span style='background-color: #a02e90'></span>400-450</div>
<div style="font-size:20px"><span style='background-color: #aa3d96'></span>350-400</div>
<div style="font-size:20px"><span style='background-color: #b54c9b'></span>300-350</div>
<div style="font-size:20px"><span style='background-color: #c05ba1'></span>250-300</div>
<div style="font-size:20px"><span style='background-color: #ca6aa6'></span>200-250</div>
<div style="font-size:20px"><span style='background-color: #df88b1'></span>150-200</div>
<div style="font-size:20px"><span style='background-color: #ea98b6'></span>100-150</div>
<div style="font-size:20px"><span style='background-color: #f4a7bc'></span>50-100</div>
<div style="font-size:20px"><span style='background-color: #ffb6c1'></span>0-50</div>
</div>

<div id='map'></div>

<script>
  mapboxgl.accessToken = '{{ mapbox_access_token }}';
  var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/mapbox/outdoors-v10', //stylesheet location
    center: [75.0896847104018,28.50769793319583], // starting position
    minZoom: 3,
    zoom: 4.7 // starting zoom
  });

  zoomThreshold = 5.5

  // chloropleth layer
  map.on('load', function() {
    map.addSource('cruelty_output-3wxcyh', {
      type: 'vector',
      url: 'mapbox://chiranjeeb2410.cwohyko2'
    });

    map.addLayer({
        'id': 'states',
        'source': 'cruelty_output-3wxcyh',
        'source-layer': 'cruelty_output-3wxcyh',
        'maxzoom': zoomThreshold,
        'type': 'fill',
        'filter': ['has', 'state_cruelty_count'],
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            "fill-color": ['interpolate', ['linear'],['get', 'state_cruelty_count'],0,"#ffb6c1",1000,"#f4a7bc",2000,
            "#ea98b6",3000,"#df88b1",4000,"#ca6aa6",5000,"#c05ba1",6000,
            "#b54c9b",7000,"#aa3d96",8000,"#a02e90",10000,"#951e8b"],
            'fill-opacity': 0.75
        }
    }, 'waterway-label');

    map.addLayer({
        'id': 'districts',
        'source': 'cruelty_output-3wxcyh',
        'source-layer': 'cruelty_output-3wxcyh',
        'minzoom': zoomThreshold,
        'type': 'fill',
        'filter': ['has', 'cruelty_count'],
        'layout': {
            'visibility': 'visible'
        },
        'paint': {
            "fill-color": ['interpolate', ['linear'],["get","cruelty_count"],0,"#ffb6c1",50,"#f4a7bc",100,
            "#ea98b6",150,"#df88b1",200,"#ca6aa6",250,"#c05ba1",300,
            "#b54c90",350,"#aa3d96",400,"#a02390",450,"#951e8b",500,"#8b0f85",550,"#800080",600,"#750075"],
            'fill-opacity': 0.7
        }
    }, 'waterway-label');

    map.on('click', 'states', function (e) {
        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(e.features[0].properties.name + ", "
            + e.features[0].properties.state_cruelty_count)
            .addTo(map);
    });

    map.on('click', 'districts', function (e) {
        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(e.features[0].properties.name + ", "
            + e.features[0].properties.cruelty_count)
            .addTo(map);
    });

    map.on('mouseenter', 'cruelty_output-3wxcyh', function () {
        map.getCanvas().style.cursor = 'pointer';
    });

    map.on('mouseleave', 'cruelty_output-3wxcyh', function () {
        map.getCanvas().style.cursor = '';
    });

    map.addControl(new mapboxgl.NavigationControl());
    map.addControl(new mapboxgl.FullscreenControl());
  });

  map.addControl(new mapboxgl.FullscreenControl());

  var stateLegendEl = document.getElementById('state-legend');
  var districtLegendEl = document.getElementById('district-legend');

  map.on('zoom', function() {
    if (map.getZoom() > zoomThreshold) {
        stateLegendEl.style.display = 'none';
        districtLegendEl.style.display = 'block';
    }
    else {
        stateLegendEl.style.display = 'block';
        districtLegendEl.style.display = 'none';
    }
  });

</script>

</body>
</html>
